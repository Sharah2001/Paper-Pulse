generator client {
  provider = "prisma-client-js"

}

datasource db {
  provider = "postgresql"

}


enum Role{
  USER
  ADMIN
}

enum OrderStatus{
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED

}

enum PaymentStatus{
  PENDING 
  COMPLETED
  FAILED
  REFUNDED


}
model User{
  id String @id @default(uuid())
  email String @unique
  password String
  firstName String?
  lastName String?
  role Role @default(USER)
  refreshToken String?


  //relations
  orders Order[]
  carts Cart[]
  payments Payment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@map("users")


}

model Product{
    id String @id @default(uuid())
    name String 
    author String?
    price Decimal @db.Decimal(10,2)
    stock Int @default(0)
    sku String @unique
    imageUrl String?
    isActive Boolean @default(true)

//relations

orderItems OrderItem[]
cartItems CartItem[]


categoryId String 
category Category @relation(fields:[categoryId], references:[id])

//timestamps

createdAt DateTime @default(now())
updatedAt DateTime @updatedAt


@@index ([sku])
@@index([categoryId])
@@index([isActive])
@@map("products") //the  name of the table


}

model Category{
    id String @id @default(uuid())
    name String
    slug String @unique
    imageUrl String?
    isActive Boolean  @default(true)
    products Product[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    @@index ([slug])
    @@index ([isActive])
    @@map("categories")

}

model OrderItem{
      id String @id @default(uuid())
      quantity Int
      price Decimal @db.Decimal(10,2)
      productId String 
      product Product @relation(fields:[productId], references:[id])

      orderId String
      order Order @relation(fields:[orderId], references:[id], onDelete:Cascade)


      createdAt DateTime @default(now())
      updatedAt DateTime @updatedAt


      @@index ([orderId])
      @@index ([productId])
      @@map("order_items")



}

model CartItem{
      id String @id @default(uuid())
      quantity Int @default(1)
      productId String 
      product Product @relation(fields:[productId], references:[id])

      cartId String
      cart Cart @relation (fields: [cartId], references:[id], onDelete:Cascade)

      createdAt DateTime @default(now())
      updatedAt DateTime @updatedAt

      @@unique([cartId, productId])
      @@index ([cartId])
      @@index ([productId])
      @@map("cart_items")

}

model Order{
    id String @id @default(uuid())
    orderNumber String @unique @default(cuid())
    status OrderStatus
    totalAmount Decimal @db.Decimal(10,2)


    userId String
    user User @relation(fields: [userId], references:[id], onDelete:Cascade)

    cartId String?
    cart Cart? @relation (fields:[cartId], references:[id])

    shippingAddress String ?

    orderItems OrderItem[]
    payment Payment?

    createdAt DateTime @default(now())
    updatedAt DateTime@updatedAt


    @@index([userId])
    @@index ([orderNumber])
    @@index ([status])
    @@map("orders")





}
model Cart{
  id String @id @default(uuid())
  userId String
  user User @relation(fields: [userId], references:[id], onDelete:Cascade)

  orders Order[]
  checkedOut Boolean @default(false)


  cartItems CartItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@map("carts")



}
 model Payment{
  id String @id @default(uuid())
  amount Decimal @db.Decimal(10,2)
  status PaymentStatus @default(PENDING)
  currency String @default ("lkr")
  PaymentMethod String?
  transactionId String?

  orderId String @unique
  order Order @relation(fields:[orderId], references:[id], onDelete:Cascade)

  userId String
  user User @relation(fields: [userId], references:[id], onDelete:Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index ([orderId])
  @@index([userId])
  @@index ([transactionId])
  @@map("payments")





 }